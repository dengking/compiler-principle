# 4.2 Context-Free Grammars

Grammars were introduced in Section 2.2 to systematically describe the syntaxof programming language constructs like **expressions** and **statements**. Usinga syntactic variable `stmt` to denote **statements** and variable `expr` to denote **expressions**, the production

![](grammar-4.4.png)

species the structure of this form of **conditional statement**. Other **productions** then dene precisely what an `expr` is and what else a `stmt` can be.

This section reviews the definition of a **context-free grammar** and introduces terminology for talking about parsing. In particular, the notion of derivations is very helpful for discussing the order in which **productions** are applied during parsing.

## 4.2.1 The Formal Definition of a Context-Free Grammar

From Section 2.2, a **context-free grammar** (grammar for short) consists of **terminals**, **nonterminals**, a **start symbol**, and **productions**.

1、***Terminals*** are the basic symbols from which strings are formed. The term "token name" is a synonym for "terminal" and frequently we will use the word "token" for terminal when it is clear that we are talking about just the token name. We assume that the terminals are the first components of the tokens output by the **lexical analyzer**. In (4.4), the terminals are the keywords `if` and `else` and the symbols `(` and `)`.

2、***Nonterminals*** are **syntactic variables** that denote sets of strings. In (4.4), `stmt` and `expr` are **nonterminals**. The sets of strings denoted by **nonterminals** help define the language generated by the grammar. Nonterminals impose a hierarchical structure on the language that is key to syntax analysis and translation.

3、In a grammar, one nonterminal is distinguished as the ***start symbol***, and the set of strings it denotes is the language generated by the grammar. Conventionally, the productions for the ***start symbol*** are listed first.

4、The productions of a grammar specify the manner in which the **terminals** and **nonterminals** can be combined to form strings. Each production consists of:

(a) A **nonterminal** called the **head** or **left side** of the **production**; this production defines some of the strings denoted by the **head**.



## 4.2.3 Derivations

> NOTE: 
>
> 一、"derivation" means "推导" in Chinese.

The construction of a parse tree can be made precise by taking a derivational view, in which productions are treated as rewriting rules. Beginning with the start symbol, each rewriting step replaces a **nonterminal** by the body of one of its productions. This derivational view corresponds to the **top-down** construction
of a **parse tree**, but the precision afforded by **derivations** will be especially helpful when **bottom-up** parsing is discussed. As we shall see, **bottom-up parsing** is related to a class of derivations known as "**rightmost**" derivations, in which the **rightmost nonterminal** is rewritten at each step.

> NOTE: 
>
> I still do not understand why bottom-up parsing corresponds "**rightmost**" derivations.
>
> $\Rightarrow$

If $S \xrightarrow []{ \ast} \alpha$ where $S$ is the start symbol of a grammar $G$, we say that $\alpha$ is a *sentential form* of G. Note that a **sentential form** may contain both **terminals** and **nonterminals**, and may be empty. A *sentence* of G is a **sentential form** with no **nonterminals**. The *language* generated by a grammar is its set of **sentences**.
Thus, a string of terminals $w$ is in $L(G)$, the language generated by G, if and only if $w$ is a sentence of G (or $S \xrightarrow []{ \ast} w $. A language that can be generated by a **grammar** is said to be a **context-free language**. If two grammars generate the same language, the grammars are said to be *equivalent*.

> NOTE: Natural language is not **context-free language**.



To understand how parsers work, we shall consider derivations in which the **nonterminal** to be replaced at each step is chosen as follows:

1、In *leftmost derivations*, the **leftmost nonterminal** in each sentential is always chosen. If $\alpha \to \beta $ is a step in which the leftmost nonterminal in $\alpha$ is replaced, we write $\alpha \xrightarrow [ \text{lm} ]{} \beta$ .

2、In *rightmost derivations*, the **rightmost nonterminal** is always chosen; we write $\alpha \xrightarrow [ \text{rm} ]{} \beta$   in this case.



If  , then we say that  is a *left-sentential form* of the grammar at hand.

Analogous definitions hold for **rightmost derivations**. Rightmost derivations are sometimes called *canonical derivations*.

## 4.2.4 Parse Trees and Derivations

A parse tree is a graphical representation of a derivation that filters out the **order** in which productions are applied to replace nonterminals. Each interior node of a parse tree represents the application of a production. The interior node is labeled with the nonterminal `A` in the head of the production; the children of the node are labeled, from left to right, by the symbols in the body of the production by which this `A` was replaced during the derivation.

> NOTE: Left-most derivation and right-most derivation yield the same tree in the end but the order in which productions are applied to replace nonterminals is different.



## 4.2.7 Context-Free Grammars Versus Regular Expressions

> NOTE: 
>
> 下面这些内容是在阅读 wikipedia [Comparison of parser generators](https://en.wikipedia.org/wiki/Comparison_of_parser_generators) 中 [Regular languages](https://en.wikipedia.org/wiki/Comparison_of_parser_generators#Regular_languages) 章节时，发现这一段的内容正好和本节内容相关，可以作为一个补充，并且它的讲解也比较易懂：
>
> > [Regular languages](https://en.wikipedia.org/wiki/Regular_language) are a category of languages (sometimes termed [Chomsky Type 3](https://en.wikipedia.org/wiki/Chomsky_hierarchy)) which can be matched by a state machine (more specifically, by a [deterministic finite automaton](https://en.wikipedia.org/wiki/Deterministic_finite_automaton) or a [nondeterministic finite automaton](https://en.wikipedia.org/wiki/Nondeterministic_finite_automaton)) constructed from a [regular expression](https://en.wikipedia.org/wiki/Regular_expression). In particular, a regular language can match constructs like "A follows B", "Either A or B", "A, followed by zero or more instances of B", but cannot match constructs which require consistency between non-adjacent elements, such as "some instances of A followed by the same number of instances of B", and also cannot express the concept of recursive "nesting" ("every A is eventually followed by a matching B"). A classic example of a problem which a regular grammar cannot handle is the question of whether a given string contains correctly-nested parentheses. (This is typically handled by a Chomsky Type 2 grammar, also termed a [context-free grammar](https://en.wikipedia.org/wiki/Context-free_grammar).)
>
> 
>
> regular expression属于[Regular languages](https://en.wikipedia.org/wiki/Regular_language)，使用[regular grammar](https://en.wikipedia.org/wiki/Regular_grammar)，按照[Chomsky hierarchy](https://en.wikipedia.org/wiki/Chomsky_hierarchy):
>
> - [regular grammar](https://en.wikipedia.org/wiki/Regular_grammar)属于[Type-3 grammars](https://en.wikipedia.org/wiki/Chomsky_hierarchy#Type-3_grammars)
> - [context-free grammar](https://en.wikipedia.org/wiki/Context-free_grammar)属于[Type-2 grammars](https://en.wikipedia.org/wiki/Chomsky_hierarchy#Type-2_grammars)
>
> 
>
> [![The Chomsky hierarchy](https://upload.wikimedia.org/wikipedia/commons/thumb/9/9a/Chomsky-hierarchy.svg/200px-Chomsky-hierarchy.svg.png)](https://en.wikipedia.org/wiki/File:Chomsky-hierarchy.svg)
>
> 
>
> Every **regular language** is **context-free**, every **context-free** language is **context-sensitive**, every **context-sensitive language** is **recursive** and every **recursive language** is recursively enumerable. These are all proper inclusions, meaning that there exist recursively enumerable languages that are not context-sensitive, context-sensitive languages that are not context-free and context-free languages that are not regular.



