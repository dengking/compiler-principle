



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Project documentation with Markdown.">
      
      
        <link rel="canonical" href="https://dengking.github.io/compiler-principle/Chapter-7-Run-Time-Environments/ABI/Function-Call/Call-convention/Calling-Conventions-Demystified/">
      
      
        <meta name="author" content="DengKing">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.0">
    
    
      
        <title>Calling Conventions Demystified - compiler principle</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/application.1b62728e.css">
      
      
    
    
      <script src="../../../../../assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../../../../css/extra.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#calling-conventions-demystified" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://dengking.github.io/compiler-principle" title="compiler principle" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              compiler principle
            </span>
            <span class="md-header-nav__topic">
              
                Calling Conventions Demystified
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/dengking/compiler-principle" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://dengking.github.io/compiler-principle" title="compiler principle" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    compiler principle
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/dengking/compiler-principle" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Chapter-1-Introduction
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Chapter-1-Introduction
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../../Chapter-1-Introduction/" title="1-Introduction" class="md-nav__link">
      1-Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../../Chapter-1-Introduction/1.1-Language-Processors/" title="1.1-Language-Processors.md" class="md-nav__link">
      1.1-Language-Processors.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../../Chapter-1-Introduction/1.2-The-Structure-of-a-Compiler/" title="1.2-The-Structure-of-a-Compiler.md" class="md-nav__link">
      1.2-The-Structure-of-a-Compiler.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../../Chapter-1-Introduction/1.5-Applications-of-Compiler-Technology/" title="1.5-Applications-of-Compiler-Technology.md" class="md-nav__link">
      1.5-Applications-of-Compiler-Technology.md
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../../Chapter-1-Introduction/1.6-Programming-Language-Basics/" title="1.6-Programming-Language-Basics.md" class="md-nav__link">
      1.6-Programming-Language-Basics.md
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Chapter-2-A-Simple-Syntax-Directed-Translator
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Chapter-2-A-Simple-Syntax-Directed-Translator
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../../Chapter-2-A-Simple-Syntax-Directed-Translator/" title="2" class="md-nav__link">
      2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../../Chapter-2-A-Simple-Syntax-Directed-Translator/2.1-Introduction/" title="2.1-Introduction" class="md-nav__link">
      2.1-Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../../Chapter-2-A-Simple-Syntax-Directed-Translator/2.2-Syntax-Definition/" title="2.2-Syntax-Definition" class="md-nav__link">
      2.2-Syntax-Definition
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../../Chapter-2-A-Simple-Syntax-Directed-Translator/2.3-Syntax-Directed-Translation/" title="2.3-Syntax-Directed-Translation" class="md-nav__link">
      2.3-Syntax-Directed-Translation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../../Chapter-2-A-Simple-Syntax-Directed-Translator/2.4-Parsing/" title="2.4-Parsing" class="md-nav__link">
      2.4-Parsing
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Chapter-3-Lexical-Analysis
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Chapter-3-Lexical-Analysis
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../../Chapter-3-Lexical-Analysis/" title="3" class="md-nav__link">
      3
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../../Chapter-3-Lexical-Analysis/3.1-The-Role-of-the-Lexical-Analyzer/" title="3.1-The-Role-of-the-Lexical-Analyzer" class="md-nav__link">
      3.1-The-Role-of-the-Lexical-Analyzer
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../../Chapter-3-Lexical-Analysis/3.4-Recognition-of-Tokens/" title="3.4-Recognition-of-Tokens" class="md-nav__link">
      3.4-Recognition-of-Tokens
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../../Chapter-3-Lexical-Analysis/3.6-Finite-Automata/" title="3.6-Finite-Automata" class="md-nav__link">
      3.6-Finite-Automata
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../../Chapter-3-Lexical-Analysis/3.7-From-Regular-Expressions-to-Automata/" title="3.7-From-Regular-Expressions-to-Automata" class="md-nav__link">
      3.7-From-Regular-Expressions-to-Automata
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Chapter-4-Syntax-Analysis
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Chapter-4-Syntax-Analysis
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../../Chapter-4-Syntax-Analysis/" title="4" class="md-nav__link">
      4
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../../Chapter-4-Syntax-Analysis/4.2-Context-Free-Grammars/" title="4.2-Context-Free-Grammars" class="md-nav__link">
      4.2-Context-Free-Grammars
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../../Chapter-4-Syntax-Analysis/4.3-Writing-a-Grammar/" title="4.3-Writing-a-Grammar" class="md-nav__link">
      4.3-Writing-a-Grammar
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../../Chapter-4-Syntax-Analysis/4.5-Bottom-Up-Parsing/" title="4.5-Bottom-Up-Parsing" class="md-nav__link">
      4.5-Bottom-Up-Parsing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../../Chapter-4-Syntax-Analysis/4.6-Introduction-to-LR-Parsing-Simple-LR/" title="4.6-Introduction-to-LR-Parsing-Simple-LR" class="md-nav__link">
      4.6-Introduction-to-LR-Parsing-Simple-LR
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../../Chapter-4-Syntax-Analysis/4.7-More-Powerful-LR-Parsers/" title="4.7-More-Powerful-LR-Parsers" class="md-nav__link">
      4.7-More-Powerful-LR-Parsers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../../Chapter-4-Syntax-Analysis/VS-LL-parser-VS-LR-parser/" title="VS-LL-parser-VS-LR-parser" class="md-nav__link">
      VS-LL-parser-VS-LR-parser
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Chapter-5-Syntax-Directed-Translation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Chapter-5-Syntax-Directed-Translation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../../Chapter-5-Syntax-Directed-Translation/" title="5" class="md-nav__link">
      5
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../../Chapter-5-Syntax-Directed-Translation/5.1-Syntax-Directed-Definitions/" title="5.1-Syntax-Directed-Definitions" class="md-nav__link">
      5.1-Syntax-Directed-Definitions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../../Chapter-5-Syntax-Directed-Translation/5.2-Evaluation-Orders-for-SDD's/" title="5.2-Evaluation-Orders-for-SDD's" class="md-nav__link">
      5.2-Evaluation-Orders-for-SDD's
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../../Chapter-5-Syntax-Directed-Translation/5.3-Applications-of-Syntax-Directed-Translation/" title="5.3--Applications-of-Syntax-Directed-Translation" class="md-nav__link">
      5.3--Applications-of-Syntax-Directed-Translation
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Chapter-6-Intermediate-Code-Generation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Chapter-6-Intermediate-Code-Generation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../../Chapter-6-Intermediate-Code-Generation/" title="6" class="md-nav__link">
      6
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../../Chapter-6-Intermediate-Code-Generation/6.3-Types-and-Declarations/" title="6.3-Types-and-Declarations" class="md-nav__link">
      6.3-Types-and-Declarations
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Chapter-7-Run-Time-Environments
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Chapter-7-Run-Time-Environments
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../" title="7" class="md-nav__link">
      7
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../7.1-Storage-Organization/" title="7.1-Storage-Organization" class="md-nav__link">
      7.1-Storage-Organization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../7.2-Stack-Allocation-of-Space/" title="7.2-Stack-Allocation-of-Space" class="md-nav__link">
      7.2-Stack-Allocation-of-Space
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Chapter-9-Machine-Independent-Optimizations
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Chapter-9-Machine-Independent-Optimizations
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../../Chapter-9-Machine-Independent-Optimizations/" title="9" class="md-nav__link">
      9
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#c-calling-convention-__cdecl" class="md-nav__link">
    C calling convention (__cdecl)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#standard-calling-convention-__stdcall" class="md-nav__link">
    Standard calling convention (__stdcall)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fast-calling-convention-__fastcall" class="md-nav__link">
    Fast calling convention (__fastcall)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thiscall" class="md-nav__link">
    Thiscall
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    Conclusion
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <div class="toc">
<ul>
<li><a href="#calling-conventions-demystified">Calling Conventions Demystified</a><ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#c-calling-convention-__cdecl">C calling convention (__cdecl)</a></li>
<li><a href="#standard-calling-convention-__stdcall">Standard calling convention (__stdcall)</a></li>
<li><a href="#fast-calling-convention-__fastcall">Fast calling convention (__fastcall)</a></li>
<li><a href="#thiscall">Thiscall</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>
</div>
<h1 id="calling-conventions-demystified"><a href="https://www.codeproject.com/articles/1388/calling-conventions-demystified">Calling Conventions Demystified</a><a class="headerlink" href="#calling-conventions-demystified" title="Permanent link">#</a></h1>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">#</a></h2>
<p>During the long, hard, but yet beautiful process of learning C++ programming for Windows, you have probably been curious about the strange specifiers that sometime appear in front of function declarations, like <code>__cdecl</code>, <code>__stdcall</code>, <code>__fastcall</code>, <code>WINAPI</code>, etc. After looking through MSDN, or some other reference, you probably found out that these specifiers specify the <em>calling conventions</em> for functions. In this article, I will try to explain different <strong>calling conventions</strong> used by Visual C++ (and probably other Windows C/C++ compilers). I emphasize that above mentioned specifiers are Microsoft-specific, and that you should not use them if you want to write portable code.</p>
<p>So, what are the calling conventions? When a function is called, the arguments are typically passed to it, and the return value is retrieved. A calling convention describes <em>how</em> the arguments are passed and values returned by functions. It also specifies how the function names are decorated. Is it really necessary to understand the calling conventions to write good C/C++ programs? Not at all. However, it may be helpful with debugging. Also, it is necessary for linking C/C++ with assembly code.</p>
<p>To understand this article, you will need to have some very basic knowledge of assembly programming.</p>
<p>No matter which calling convention is used, the following things will happen:</p>
<ol>
<li>All arguments are widened to 4 bytes (on Win32, of course), and put into appropriate memory locations. These locations are typically on the stack, but may also be in registers; this is specified by <strong>calling conventions</strong>.</li>
<li>Program execution <strong>jumps</strong> to the address of the <strong>called function</strong>.</li>
<li>Inside the function, registers <a href="https://en.wikipedia.org/wiki/X86#32-bit"><strong>ESI</strong></a>, <a href="https://en.wikipedia.org/wiki/X86#32-bit"><strong>EDI</strong></a>, <a href="https://en.wikipedia.org/wiki/X86#32-bit"><strong>EBX</strong></a>, and <a href="https://en.wikipedia.org/wiki/X86#32-bit"><strong>EBP</strong></a> are saved on the stack. The part of code that performs these operations is called <em>function prolog</em>(函数开场) and usually is generated by the compiler.</li>
<li>The function-specific code is executed, and the return value is placed into the EAX register.</li>
<li>Registers ESI, EDI, EBX, and EBP are restored from the stack. The piece of code that does this is called <em>function epilog</em>(函数收场), and as with the function prolog, in most cases the compiler generates it.</li>
<li>Arguments are removed from the stack. This operation is called <em>stack cleanup</em> and may be performed either inside the called function or by the caller, depending on the calling convention used.</li>
</ol>
<p>As an example for the calling conventions (except for <em>this</em>), we are going to use a simple function:</p>
<p>Hide   Copy Code</p>
<pre><code class="c">int sumExample (int a, int b)
{
    return a + b;
}
</code></pre>

<p>The call to this function will look like this:</p>
<p>Hide   Copy Code</p>
<pre><code class="c">int c = sum (2, 3);
</code></pre>

<p>For <code>__cdecl</code>, <code>__stdcall</code>, and <code>__fastcall</code> calling conventions, I compiled the example code as C (not C++). The <strong>function name decorations</strong>, mentioned later in the article, apply to the C decoration schema. C++ name decorations are beyond the scope of this article.</p>
<h2 id="c-calling-convention-__cdecl">C calling convention (<code>__cdecl</code>)<a class="headerlink" href="#c-calling-convention-__cdecl" title="Permanent link">#</a></h2>
<p>This convention is the default for C/C++ programs (compiler option /Gd). If a project is set to use some other calling convention, we can still declare a function to use <code>__cdecl</code>:</p>
<p>Hide   Copy Code</p>
<pre><code>int __cdecl sumExample (int a, int b);
</code></pre>

<p>The main characteristics of <code>__cdecl</code>calling convention are:</p>
<ol>
<li>Arguments are passed from right to left, and placed on the stack.</li>
<li>Stack cleanup is performed by the caller.</li>
<li><strong>Function name</strong> is decorated by prefixing it with an underscore character '_' .</li>
</ol>
<p>Now, take a look at an example of a <code>__cdecl</code> call:</p>
<p>Hide   Copy Code</p>
<pre><code class="assembly">; // push arguments to the stack, from right to left
push        3    
push        2    

; // call the function
call        _sumExample 

; // cleanup the stack by adding the size of the arguments to ESP register
add         esp,8 

; // copy the return value from EAX to a local variable (int c)
mov         dword ptr [c],eax
</code></pre>

<p>The called function is shown below:</p>
<p>Hide   Copy Code</p>
<pre><code class="assembly">; // function prolog
  push        ebp  
  mov         ebp,esp 
  sub         esp,0C0h 
  push        ebx  
  push        esi  
  push        edi  
  lea         edi,[ebp-0C0h] 
  mov         ecx,30h 
  mov         eax,0CCCCCCCCh 
  rep stos    dword ptr [edi] 

; //    return a + b;
  mov         eax,dword ptr [a] 
  add         eax,dword ptr [b] 

; // function epilog
  pop         edi  
  pop         esi  
  pop         ebx  
  mov         esp,ebp 
  pop         ebp  
  ret
</code></pre>

<h2 id="standard-calling-convention-__stdcall">Standard calling convention (<code>__stdcall</code>)<a class="headerlink" href="#standard-calling-convention-__stdcall" title="Permanent link">#</a></h2>
<p>This convention is usually used to call Win32 API functions. In fact, <code>WINAPI</code> is nothing but another name for <code>__stdcall</code>:</p>
<p>Hide   Copy Code</p>
<pre><code class="cpp">#define WINAPI __stdcall
</code></pre>

<p>We can explicitly declare a function to use the <code>__stdcall</code> convention:</p>
<p>Hide   Copy Code</p>
<pre><code class="c">int __stdcall sumExample (int a, int b);
</code></pre>

<p>Also, we can use the compiler option <em>/Gz</em> to specify <code>__stdcall</code> for all functions not explicitly declared with some other calling convention.</p>
<p>The main characteristics of <code>__stdcall</code> calling convention are:</p>
<ol>
<li>Arguments are passed from right to left, and placed on the stack.</li>
<li>Stack cleanup is performed by the called function.</li>
<li>Function name is decorated by prepending an underscore character and appending a '@' character and the number of bytes of stack space required.</li>
</ol>
<p>The example follows:</p>
<p>Hide   Copy Code</p>
<pre><code class="assembly">; // push arguments to the stack, from right to left
  push        3    
  push        2    

; // call the function
  call        _sumExample@8

; // copy the return value from EAX to a local variable (int c)  
  mov         dword ptr [c],eax
</code></pre>

<p>The function code is shown below:</p>
<p>Hide   Copy Code</p>
<pre><code class="assembly">; // function prolog goes here (the same code as in the __cdecl example)

; //    return a + b;
  mov         eax,dword ptr [a] 
  add         eax,dword ptr [b] 

; // function epilog goes here (the same code as in the __cdecl example)

; // cleanup the stack and return
  ret         8
</code></pre>

<p>Because the stack is cleaned by the called function, the <code>__stdcall</code> calling convention creates smaller executables than <code>__cdecl</code>, in which the code for stack cleanup must be generated for each function call. On the other hand, functions with the variable number of arguments (like <code>printf()</code>) must use <code>__cdecl</code>, because only the <strong>caller</strong> knows the number of arguments in each function call; therefore only the caller can perform the stack cleanup.</p>
<h2 id="fast-calling-convention-__fastcall">Fast calling convention (__fastcall)<a class="headerlink" href="#fast-calling-convention-__fastcall" title="Permanent link">#</a></h2>
<p>Fast calling convention indicates that the arguments should be placed in registers, rather than on the stack, whenever possible. This reduces the cost of a function call, because operations with registers are faster than with the stack.</p>
<p>We can explicitly declare a function to use the <code>__fastcall</code> convention as shown:</p>
<p>Hide   Copy Code</p>
<pre><code class="c">int __fastcall sumExample (int a, int b);
</code></pre>

<p>We can also use the compiler option <em>/Gr</em> to specify <code>__fastcall</code> for all functions not explicitly declared with some other calling convention.</p>
<p>The main characteristics of <code>__fastcall</code> calling convention are:</p>
<ol>
<li>The first two function arguments that require 32 bits or less are placed into registers ECX and EDX. The rest of them are pushed on the stack from right to left.</li>
<li>Arguments are popped from the stack by the called function.</li>
<li>Function name is decorated by by prepending a '@' character and appending a '@' and the number of bytes (decimal) of space required by the arguments.</li>
</ol>
<p>Note: Microsoft have reserved the right to change the registers for passing the arguments in future compiler versions.</p>
<p>Here goes an example:</p>
<p>Hide   Copy Code</p>
<pre><code class="assembly">; // put the arguments in the registers EDX and ECX
  mov         edx,3 
  mov         ecx,2 

; // call the function
  call        @fastcallSum@8

; // copy the return value from EAX to a local variable (int c)  
  mov         dword ptr [c],eax
</code></pre>

<p>Function code:</p>
<p>Hide   Copy Code</p>
<pre><code class="assembly">; // function prolog

  push        ebp  
  mov         ebp,esp 
  sub         esp,0D8h 
  push        ebx  
  push        esi  
  push        edi  
  push        ecx  
  lea         edi,[ebp-0D8h] 
  mov         ecx,36h 
  mov         eax,0CCCCCCCCh 
  rep stos    dword ptr [edi] 
  pop         ecx  
  mov         dword ptr [ebp-14h],edx 
  mov         dword ptr [ebp-8],ecx 
; // return a + b;
  mov         eax,dword ptr [a] 
  add         eax,dword ptr [b] 
;// function epilog  
  pop         edi  
  pop         esi  
  pop         ebx  
  mov         esp,ebp 
  pop         ebp  
  ret
</code></pre>

<p>How fast is this calling convention, comparing to <code>__cdecl</code> and <code>__stdcall</code>? Find out for yourselves. Set the compiler option <em>/Gr</em>, and compare the execution time. I didn't find <code>__fastcall</code> to be any faster than other calling conventons, but you may come to different conclusions.</p>
<h2 id="thiscall">Thiscall<a class="headerlink" href="#thiscall" title="Permanent link">#</a></h2>
<p><code>Thiscall</code> is the default calling convention for calling member functions of C++ classes (except for those with a variable number of arguments).</p>
<p>The main characteristics of <code>thiscall</code> calling convention are:</p>
<ol>
<li>Arguments are passed from right to left, and placed on the stack. <code>this</code> is placed in <strong>ECX</strong>.</li>
<li>Stack cleanup is performed by the called function.</li>
</ol>
<p>The example for this calling convention had to be a little different. First, the code is compiled as C++, and not C. Second, we have a struct with a member function, instead of a global function.</p>
<p>Hide   Copy Code</p>
<pre><code class="cpp">struct CSum
{
    int sum ( int a, int b) {return a+b;}
};
</code></pre>

<p>The assembly code for the function call looks like this:</p>
<p>Hide   Copy Code</p>
<pre><code class="cpp">push        3
push        2
lea         ecx,[sumObj]
call        ?sum@CSum@@QAEHHH@Z            ; CSum::sum
mov         dword ptr [s4],eax
</code></pre>

<p>The function itself is given below:</p>
<p>Hide   Copy Code</p>
<pre><code class="cpp">push        ebp
mov         ebp,esp
sub         esp,0CCh
push        ebx
push        esi
push        edi
push        ecx
lea         edi,[ebp-0CCh]
mov         ecx,33h
mov         eax,0CCCCCCCCh
rep stos    dword ptr [edi]
pop         ecx
mov         dword ptr [ebp-8],ecx
mov         eax,dword ptr [a]
add         eax,dword ptr [b]
pop         edi
pop         esi
pop         ebx
mov         esp,ebp
pop         ebp
ret         8
</code></pre>

<p>Now, what happens if we have a member function with a variable number of arguments? In that case, <code>__cdecl</code> is used, and <code>this</code> is pushed onto the stack last.</p>
<h2 id="conclusion">Conclusion<a class="headerlink" href="#conclusion" title="Permanent link">#</a></h2>
<p>To cut a long story short, we'll outline the main differences between the calling conventions:</p>
<ul>
<li><code>__cdecl</code> is the default calling convention for C and C++ programs. The advantage of this calling convetion is that it allows functions with a variable number of arguments to be used. The disadvantage is that it creates larger executables.</li>
<li><code>__stdcall</code> is used to call Win32 API functions. It does not allow functions to have a variable number of arguments.</li>
<li><code>__fastcall</code> attempts to put arguments in registers, rather than on the stack, thus making function calls faster.</li>
<li><code>Thiscall</code> calling convention is the default calling convention used by C++ member functions that do not use variable arguments.</li>
</ul>
<p>In most cases, this is all you'll ever need to know about the calling conventions.</p>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../../../assets/javascripts/application.808e90bb.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../../../.."}})</script>
      
    
  </body>
</html>